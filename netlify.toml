
# https://docs.netlify.com/configure-builds/file-based-configuration/#sample-file
[build]
  publish = "_site/"
  # https://docs.netlify.com/configure-builds/file-based-configuration/#inject-environment-variable-values
  command = 'sed -i "s|HEADER_PLACEHOLDER|${AUTHORIZATION_HEADER_VALUE}|g" netlify.toml && npm run build'

# https://www.netlify.com/products/dev/
# https://github.com/netlify/cli/blob/master/docs/netlify-dev.md
[dev]
  publish    = "_site/"
  command    = "npm run serve"
  targetPort = 4000
  port       = 8888
  autoLaunch = true

[[redirects]]
  from = "https://www.dollyskettle.com/*"
  to = "https://dollyskettle.com/:splat"
  status = 302
  force = true

# https://docs.netlify.com/routing/redirects/#syntax-for-the-netlify-configuration-file
[[redirects]]
  from = "/index/"
  to = "/recipes/"
  status = 302
  force = true
  # query = {path = ":path"}
  # conditions = {Language = ["en"], Country = ["US"], Role = ["admin"]}
  # headers = {X-From = "Netlify"}
  # signed = "API_SIGNATURE_TOKEN"

[[redirects]]
  from = "/wp-admin/*"
  to = "https://content.dollyskettle.com/wp-admin/:splat"
  status = 302

# Production context:
# All deploys from the main repository branch
# will inherit these settings.
[context.production.environment]
  # https://docs.netlify.com/routing/redirects/rewrites-proxies/#proxy-to-another-service
  [[redirects]]
    from = "/wp-content/uploads/*"
    to = "https://content.dollyskettle.com/wp-content/uploads/:splat"
    status = 200
    force = true
    headers = {Authorization = "HEADER_PLACEHOLDER"}

# Deploy Preview context:
# All deploys generated from a pull/merge request
# will inherit these settings.
[context.deploy-preview.environment]
  # https://docs.netlify.com/routing/redirects/rewrites-proxies/#proxy-to-another-service
  [[redirects]]
    from = "/wp-content/uploads/*"
    to = "https://content.dollyskettle.com/wp-content/uploads/:splat"
    status = 200
    force = true
    headers = {Authorization = "HEADER_PLACEHOLDER"}

# Branch deploy context:
# All deploys that are not from a pull/merge request
# or from the production branch will inherit these settings.
# [context.branch-deploy]

# Specific branch context:
# Deploys from this branch will take these settings
# and override their current ones.
[context."automatically-cached-content"]
  ASK_SEARCH_ENGINES_NOT_TO_INDEX=1
  USE_LOCAL_DATA = 1
